import{r}from"./index-Cub6i1Ni.js";import{y as g}from"./js.cookie-D3iyxcDy.js";const T=(n,a={})=>{const{immediate:i=!1,onSuccess:o,onError:c,showToast:u=!1,initialData:E=null}=a,[y,A]=r.useState(E),[h,m]=r.useState(!1),[w,d]=r.useState(null),t=r.useRef(null),s=r.useRef(!0);r.useEffect(()=>(s.current=!0,()=>{s.current=!1,t.current&&t.current.abort()}),[]);const f=r.useCallback(async(...S)=>{var p,b,x,R;try{t.current&&t.current.abort(),t.current=new AbortController,m(!0),d(null);const e=await n(...S);return s.current?(A(e),o&&o(e),u&&(e!=null&&e.ResponseText)&&g.success(e.ResponseText),e):void 0}catch(e){if(!s.current||e.name==="AbortError"||e.message==="canceled")return;const l=((b=(p=e.response)==null?void 0:p.data)==null?void 0:b.ResponseText)||((R=(x=e.response)==null?void 0:x.data)==null?void 0:R.message)||e.message||"An unexpected error occurred";throw d(l),c&&c(l),u&&g.error(l),e}finally{s.current&&m(!1)}},[n,o,c,u]),C=r.useCallback(()=>{t.current&&t.current.abort()},[]);return r.useEffect(()=>{i&&f()},[i]),{data:y,loading:h,error:w,execute:f,cancel:C,refetch:f}},L=(n,a={})=>T(n,{...a,immediate:!1});export{L as u};
