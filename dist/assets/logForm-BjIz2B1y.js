import{r as S,a as q,j as t,B as s,C as B}from"./index-BHNVHtdT.js";import{y as h,C as F}from"./js.cookie-dTu_y0vz.js";import{c as R,b as p,F as T}from"./index.esm-DVKeHXTk.js";import{H as W}from"./Header-Ds1_fXU1.js";import{S as I}from"./staticFormServices-BkVNdnLo.js";import{A as j}from"./Autocomplete-CfULzDOy.js";import{T as m}from"./TextField-rLvJhvSW.js";import"./api-De-UYRK6.js";import"./IconButton-BDVsVlra.js";const O={room_number:"",resident_name:"",log_text:"",logged_by:"",action_taken:"",follow_up_required:""},$=R({room_number:p().required("Room Number is required"),resident_name:p().required("Resident Name is required"),log_text:p().required("This field is required"),logged_by:p().required("Logged By is required")}),z=()=>{const[x,w]=S.useState(!1),C=q(),[n]=S.useState(()=>{const o=localStorage.getItem("userData");return o?JSON.parse(o):null}),[_,v]=S.useState(()=>{const o=localStorage.getItem("completedNames");return o?JSON.parse(o):[]});console.log(n);const N=async(o,d)=>{var c;const a=(c=o.logged_by)==null?void 0:c.trim();if(a&&!_.includes(a)){const e=[..._,a];v(e),localStorage.setItem("completedNames",JSON.stringify(e))}const u=n.rooms.find(e=>String(e.name).toLowerCase()===String(o==null?void 0:o.room_number).toLowerCase()),i=new Date,r=e=>e.toString().padStart(2,"0"),l=`${i.getFullYear()}-${r(i.getMonth()+1)}-${r(i.getDate())} ${r(i.getHours())}:${r(i.getMinutes())}:${r(i.getSeconds())}`,g={...o};g.is_completed=0,g.logged_at=l;const b={form_type:2,room_id:u==null?void 0:u.id,data:JSON.stringify(g)};try{const e=await I.logFormSubmit(b);(e==null?void 0:e.ResponseCode)==="1"&&(h.success((e==null?void 0:e.ResponseText)||"Form submitted successfully."),setTimeout(()=>{C("/staticForms")},1200))}catch{h.error("Form is not submitted. Please try again.")}finally{w(!1)}};return t.jsxs(s,{m:"20px",children:[t.jsx(W,{title:"LOG FORM",Buttons:!1}),x?t.jsx(s,{display:"flex",justifyContent:"center",alignItems:"center",height:"calc(100vh - 100px)",children:t.jsx(B,{})}):t.jsx(t.Fragment,{children:t.jsx(T,{initialValues:O,onSubmit:N,validationSchema:$,validateOnBlur:!0,validateOnChange:!1,children:({values:o,handleChange:d,handleBlur:a,handleSubmit:u,setFieldValue:i,errors:r,touched:l,isSubmitting:g,isValid:b,submitCount:c})=>t.jsx("form",{onSubmit:e=>{e.preventDefault(),u(),!b&&c===0&&h.warn("Room Number is not valid.")},children:t.jsxs(s,{display:"flex",flexDirection:"column",gap:2,mx:"auto",children:[t.jsxs(s,{display:"flex",gap:2,children:[t.jsx(j,{freeSolo:!0,options:n!=null&&n.rooms?n.rooms.map(e=>e.name):[],value:o.room_number,onInputChange:(e,f)=>{if(i("room_number",f),n!=null&&n.rooms&&Array.isArray(n.rooms)){const y=n.rooms.find(L=>String(L.name).toLowerCase()===String(f).toLowerCase());y&&y.resident_name?i("resident_name",y.resident_name):i("resident_name","")}},onBlur:a,fullWidth:!0,renderInput:e=>t.jsx(m,{...e,label:"Room Number",name:"room_number",variant:"filled",fullWidth:!0,error:l.room_number&&!!r.room_number,helperText:l.room_number&&r.room_number}),ListboxProps:{style:{maxHeight:150,overflowY:"auto"}}}),t.jsx(m,{label:"Resident Name",name:"resident_name",value:o.resident_name,onChange:d,disabled:!0,onBlur:a,variant:"filled",fullWidth:!0,error:l.resident_name&&!!r.resident_name,helperText:l.resident_name&&r.resident_name})]}),t.jsx(m,{label:"What it is about",name:"log_text",value:o.log_text,onChange:d,onBlur:a,variant:"filled",fullWidth:!0,multiline:!0,minRows:3,error:l.log_text&&!!r.log_text,helperText:l.log_text&&r.log_text}),t.jsxs(s,{display:"flex",gap:2,children:[t.jsx(j,{freeSolo:!0,options:_,value:o.logged_by,onInputChange:(e,f)=>i("logged_by",f),fullWidth:!0,renderInput:e=>t.jsx(m,{...e,label:"Logged By",name:"logged_by",variant:"filled",fullWidth:!0,onBlur:a,error:l.logged_by&&!!r.logged_by,helperText:l.logged_by&&r.logged_by}),ListboxProps:{style:{maxHeight:150,overflowY:"auto"}}}),t.jsx(m,{label:"Action Taken",name:"action_taken",value:o.action_taken,onChange:d,onBlur:a,variant:"filled",fullWidth:!0})]}),t.jsx(m,{label:"Follow up required",name:"follow_up_required",value:o.follow_up_required,onChange:d,onBlur:a,variant:"filled",fullWidth:!0}),t.jsx(s,{display:"flex",alignItems:"center",justifyContent:"center",mt:"20px",children:t.jsx(F,{type:"submit",disabled:x,sx:{width:"200px",bgcolor:"#1976d2",color:"#fcfcfc",fontSize:"16px",fontWeight:"bold",p:"10px 20px",mt:"18px",transition:".3s ease",":hover":{bgcolor:"#115293"}},children:x?"Loading...":"Submit"})})]})})})})]})};export{z as default};
