import{c as D,j as o,u as F,r as d,a as M,B as u,T as O}from"./index-B2zZfDn8.js";import{t as P,u as V,y as x,L as q,C as X}from"./js.cookie-D-3Lvjpx.js";import{l as $}from"./logo-06Lthgp1.js";import{r as H}from"./api-CXf06R5e.js";import{u as J}from"./useApi-BX3zpIRg.js";import"./lodash-D0MkLC-x.js";import{s as Q,v as U}from"./validation-DU6JwJcE.js";import{T as v}from"./TextField-Dbx5wLu6.js";const Y=D(o.jsx("path",{d:"M11 7 9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5zm9 12h-8v2h8c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-8v2h8z"}),"LoginOutlined"),G={login:async({roomNo:m,password:n})=>{if(!m||!n)throw new Error("Room number and password are required");return H.post(`/login?room_no=${m}&password=${n}`)}},ie=()=>{const m=F(),n=P(m.palette.mode);V("(min-width: 724px)");const[r,y]=d.useState({roomNo:"",password:""}),[i,p]=d.useState({}),g=M(),{execute:f,loading:h}=J(({roomNo:e,password:t})=>G.login({roomNo:e,password:t}),{onSuccess:e=>{e.ResponseCode==="1"?j(e):x.error(e.ResponseText||"Login failed. Please try again.")},onError:e=>{var s,l,a,c;const t=((l=(s=e.response)==null?void 0:s.data)==null?void 0:l.error)||((c=(a=e.response)==null?void 0:a.data)==null?void 0:c.ResponseText)||"An unexpected error occurred. Please try again.";x.error(t)}}),j=d.useCallback(e=>{const{authentication_token:t,role:s,user_id:l,show_dining:a,show_incident:c,language:w,guideline:C,guideline_cn:L,room_id:S,rooms:T,form_types:k,user_list:N,breakfast_guideline:A,breakfast_guideline_cn:R,lunch_guideline:I,lunch_guideline_cn:z,dinner_guideline:E,dinner_guideline_cn:W}=e,B={role:s,user_id:l,show_dining:a,show_incident:c,language:w,langCode:w===1?"cn":"en",guideline:C,guideline_cn:L,room_id:S,rooms:T,form_types:k,user_list:N,breakfast_guideline:A,breakfast_guideline_cn:R,lunch_guideline:I,lunch_guideline_cn:z,dinner_guideline:E,dinner_guideline_cn:W};localStorage.setItem("authToken",t),localStorage.setItem("userData",JSON.stringify(B)),x.success(e.ResponseText||"Successfully Login"),setTimeout(()=>{s==="user"?g("/order",{state:{roomNo:r==null?void 0:r.roomNo}}):g(c===1&&s==="admin"||s==="kitchen"?"/home":"/room")},1e3)},[g,r.roomNo]),b=d.useCallback(e=>{const{name:t,value:s}=e.target,l=Q(s);y(a=>({...a,[t]:l})),i[t]&&p(a=>({...a,[t]:""}))},[i]),_=d.useCallback(async e=>{e.preventDefault();const t=U(r);if(!t.isValid){p(t.errors);return}p({}),await f(r)},[r,f]);return o.jsxs(u,{display:"flex",height:"100vh",width:"100%",sx:{overflowX:"hidden",overflowY:"auto"},children:[o.jsx(q,{}),o.jsx(u,{flex:7,sx:{backgroundColor:n.blueAccent[700],height:"100vh",width:"100%",overflowX:"hidden"}}),o.jsx(u,{flex:5,display:"flex",alignItems:"center",justifyContent:"center",sx:{backgroundColor:"white",height:"100vh",width:"100%"},children:o.jsxs(u,{component:"form",onSubmit:_,sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",maxWidth:"400px",padding:"20px",margin:"0 auto"},children:[o.jsx("img",{src:$,alt:"Logo",style:{width:80,marginBottom:16}}),o.jsxs(O,{variant:"h6",gutterBottom:!0,sx:{textAlign:"center",textTransform:"uppercase",fontWeight:700},children:["Welcome to our ",o.jsx("br",{})," Exceptional ",o.jsx("br",{}),"Senior Living"]}),o.jsx(v,{label:"Room No",name:"roomNo",type:"text",value:r.roomNo,onChange:b,error:!!i.roomNo,helperText:i.roomNo,fullWidth:!0,margin:"normal",autoComplete:"username",disabled:h}),o.jsx(v,{label:"Password",name:"password",type:"password",value:r.password,onChange:b,error:!!i.password,helperText:i.password,fullWidth:!0,margin:"normal",autoComplete:"current-password",disabled:h}),o.jsx(u,{children:o.jsx(X,{type:"submit",disabled:h,startIcon:o.jsx(Y,{}),sx:{bgcolor:n.blueAccent[50],color:n.blueAccent[700],"&:hover":{bgcolor:n.blueAccent[100],color:n.blueAccent[800]},padding:"10px 32px",boxShadow:"none",borderRadius:"30px",border:"none",borderRadius:4,fontWeight:600,fontSize:16,cursor:"pointer",width:"auto"},children:h?"Loading...":"Login"})})]})})]})};export{ie as default};
