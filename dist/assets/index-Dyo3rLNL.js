import{u as De,r as p,j as r,B as D,C as Ce,R as Re,T as ae}from"./index-B2zZfDn8.js";import{t as Me,C as ke}from"./js.cookie-D-3Lvjpx.js";import{H as Te,M as le,O as ie}from"./Header-Bp_wk4-C.js";import{d as o,L as Ae,A as ve,D as N}from"./AdapterDayjs-BvR1z9qa.js";import{T as $e,M as Ee,P as we,c as Ne}from"./TextField-Dbx5wLu6.js";import{M as T}from"./Tooltip-8gstuMH8.js";import{I as Le}from"./IconButton-Cglkh1w2.js";import{S as Pe,T as Ye,a as Be,b as Oe,c as A,d as ze}from"./SummarizeOutlined-DPhYbBED.js";import{T as s}from"./TableCell-0QmX6cRa.js";import"./api-CXf06R5e.js";import"./InputAdornment-DGZzny-l.js";const rr=()=>{var O,z,F,W,I,H;const se=De(),d=Me(se.palette.mode),[L,P]=p.useState(null),[a,ce]=p.useState(o().startOf("month")),[l,de]=p.useState(o()),[C,pe]=p.useState(o()),[me,R]=p.useState(!1),[e,v]=p.useState({}),[Fe,ue]=p.useState(!0),[We,he]=p.useState(null),[f,Y]=p.useState("Single Date Record"),[_,$]=p.useState({open:!1,anchorEl:null,text:"",title:""});p.useEffect(()=>{f==="Single Date Record"&&(async()=>{try{R(!0);const i=await ie.getCharges(C.format("YYYY-MM-DD"));v(i)}catch(i){console.error("Error fetching menu list:",i)}finally{R(!1)}})()},[C,f]),p.useEffect(()=>{if(f==="Multiple Date Record"&&a&&l&&o(a).isValid()&&o(l).isValid()){if(o(l).isBefore(o(a),"day")){console.error("End date cannot be before start date"),v({});return}(async()=>{try{R(!0);const i=await ie.getMultipleDateChargesReportList(o(a).format("YYYY-MM-DD"),o(l).format("YYYY-MM-DD"));v(i)}catch(i){console.error("Error fetching menu list:",i)}finally{R(!1)}})()}},[a,l,f]);const xe=t=>{t&&!t.isSame(C,"day")&&pe(t),ue(!1)},fe=t=>{P(t.currentTarget)},_e=()=>{P(null)},B=()=>he(null);return r.jsxs(D,{m:"20px",children:[r.jsx(Te,{title:"Charges Report",profileScreen:!0}),r.jsxs(D,{mt:"40px",height:"75vh",flex:1,sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{border:"none"},"& .name-column--cell":{color:d.greenAccent[300]},"& .MuiDataGrid-columnHeaders":{backgroundColor:d.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:d.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:d.blueAccent[700]},"& .MuiCheckbox-root":{color:`${d.greenAccent[200]} !important`},"& .MuiDataGrid-iconSeparator":{color:d.primary[100]}},children:[r.jsxs(D,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[r.jsx(Ae,{dateAdapter:ve,children:f==="Multiple Date Record"?r.jsxs(D,{display:"flex",gap:2,children:[r.jsx(N,{label:"Start Date",value:a,onChange:t=>ce(t),maxDate:l,slotProps:{textField:{fullWidth:!0,variant:"filled",error:l&&a&&o(a).isAfter(o(l),"day"),helperText:l&&a&&o(a).isAfter(o(l),"day")?"Start date cannot be after end date":""}}}),r.jsx(N,{label:"End Date",value:l,onChange:t=>de(t),minDate:a,slotProps:{textField:{fullWidth:!0,variant:"filled",error:l&&a&&o(l).isBefore(o(a),"day"),helperText:l&&a&&o(l).isBefore(o(a),"day")?"End date cannot be before start date":""}}})]}):r.jsx(N,{label:"Date",value:C,onChange:xe,renderInput:t=>r.jsx($e,{...t,fullWidth:!0,variant:"filled",sx:{gridColumn:"span 1"}})})}),r.jsx(T,{title:"Reports",arrow:!0,children:r.jsx(Le,{onClick:fe,sx:{color:d.blueAccent[700],"&:hover":{backgroundColor:d.blueAccent[800],color:d.gray[100]}},children:r.jsx(Pe,{sx:{fontSize:"28px"}})})}),r.jsxs(Ee,{anchorEl:L,open:!!L,onClose:_e,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},disableScrollLock:!0,children:[r.jsx(le,{selected:f==="Single Date Record",onClick:()=>{Y("Single Date Record"),B()},children:"Single Date Record"}),r.jsx(le,{selected:f==="Multiple Date Record",onClick:()=>{Y("Multiple Date Record"),B()},children:"Multiple Date Record"})]})]}),me?r.jsx(Ce,{}):r.jsx(Ye,{component:we,children:r.jsxs(Be,{sx:{border:"1px solid rgba(224, 224, 224, 1)",borderCollapse:"collapse"},children:[r.jsxs(Oe,{children:[r.jsxs(A,{sx:{backgroundColor:d.blueAccent[700]},children:[r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},rowSpan:2,children:"#"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((O=e==null?void 0:e.breakfast_item_list)==null?void 0:O.length)||0,1),children:"Breakfast"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((z=e==null?void 0:e.lunch_item_list)==null?void 0:z.length)||0,1),children:"Lunch"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((F=e==null?void 0:e.dinner_item_list)==null?void 0:F.length)||0,1),children:"Dinner"})]}),r.jsxs(A,{sx:{backgroundColor:d.blueAccent[700]},children:[e!=null&&e.breakfast_item_list&&e.breakfast_item_list.length>0?e.breakfast_item_list.map((t,i)=>{const b=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(m=>`${m.date}: ${m.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(T,{title:b(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`breakfast-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"}),e!=null&&e.lunch_item_list&&e.lunch_item_list.length>0?e.lunch_item_list.map((t,i)=>{const b=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(m=>`${m.date}: ${m.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(T,{title:b(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`lunch-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"}),e!=null&&e.dinner_item_list&&e.dinner_item_list.length>0?e.dinner_item_list.map((t,i)=>{const b=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(m=>`${m.date}: ${m.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(T,{title:b(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`dinner-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"})]})]}),r.jsx(ze,{children:(!(e!=null&&e.report_breakfast_list)||e.report_breakfast_list.length===0)&&(!(e!=null&&e.report_lunch_list)||e.report_lunch_list.length===0)&&(!(e!=null&&e.report_dinner_list)||e.report_dinner_list.length===0)?r.jsx(A,{children:r.jsx(s,{colSpan:Math.max(1+(((W=e==null?void 0:e.breakfast_item_list)==null?void 0:W.length)||0)+(((I=e==null?void 0:e.lunch_item_list)==null?void 0:I.length)||0)+(((H=e==null?void 0:e.dinner_item_list)==null?void 0:H.length)||0),4),align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)",padding:"40px",fontSize:"16px",fontWeight:500,color:d.gray[500]},children:"No Report Found"})}):(()=>{var m,q,G;const t=[...((m=e==null?void 0:e.report_breakfast_list)==null?void 0:m.map(c=>c.room_no))||[],...((q=e==null?void 0:e.report_lunch_list)==null?void 0:q.map(c=>c.room_no))||[],...((G=e==null?void 0:e.report_dinner_list)==null?void 0:G.map(c=>c.room_no))||[]];return[...new Set(t)].map(c=>({room_no:c})).map((c,Ie)=>{var U,K,J;const ge=((U=e==null?void 0:e.report_breakfast_list)==null?void 0:U.find(x=>x.room_no===c.room_no))||{data:{},option:{}},be=((K=e==null?void 0:e.report_lunch_list)==null?void 0:K.find(x=>x.room_no===c.room_no))||{data:{},option:{}},je=((J=e==null?void 0:e.report_dinner_list)==null?void 0:J.find(x=>x.room_no===c.room_no))||{data:{},option:{}};return r.jsxs(A,{children:[r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:c.room_no}),[{row:ge,itemList:e==null?void 0:e.breakfast_item_list,prefix:"b"},{row:be,itemList:e==null?void 0:e.lunch_item_list,prefix:"l"},{row:je,itemList:e==null?void 0:e.dinner_item_list,prefix:"d"}].map(({row:x,itemList:E,prefix:Q},ye)=>r.jsx(Re.Fragment,{children:E&&E.length>0?E.map((u,V)=>{var ee,re,te,ne,oe;const X=(u==null?void 0:u.item_name)||"";let y=(ee=x.data)==null?void 0:ee[X];const h=(re=x.option)==null?void 0:re[X];let g="";u.real_item_name?g=u.real_item_name:u.data&&(Array.isArray(u.data)?g=((te=u.data[0])==null?void 0:te.real_item_name)||"":u.data.real_item_name&&(g=u.data.real_item_name));let S="",M="",Z="";if(Array.isArray(h))if(h.length>0&&((ne=h[0])==null?void 0:ne.date)&&((oe=h[0])==null?void 0:oe.items)){Z=g;const j=[];h.forEach(n=>{n.date&&Array.isArray(n.items)&&n.items.forEach(k=>{k.itemName&&j.push(`${n.date}: ${k.itemName}`)})}),S=j.join(", "),M=j.join(`
`)}else{const j=h.filter(n=>n&&(typeof n=="object"?n.itemName||n.optionName:n)).map(n=>{if(typeof n=="object"&&(n.itemName||n.optionName)){const k=n.itemName||n.optionName;return`${g} - ${k}`}return typeof n=="string"?`${g} - ${n}`:""}).filter(n=>n.trim().length>0);S=j.join(", "),M=j.join(`
`)}else typeof h=="string"&&(S=h,M=`${g} - ${h}`);const Se=V>=4&&y>=1&&S&&S.trim().length>0;return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:y==null?"-":Se?r.jsx("span",{style:{textDecoration:"underline",cursor:"pointer",color:"#1976d2"},onClick:w=>{w.stopPropagation(),$({open:!0,anchorEl:w.currentTarget,text:M||"No option available",title:Z})},children:y}):y},`${Q}-${V}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"})},`${Q}-meal-${ye}`))]},c.room_no)})})()})]})}),r.jsxs(Ne,{open:_.open,anchorEl:_.anchorEl,onClose:()=>$({..._,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},disableEnforceFocus:!0,disableRestoreFocus:!0,disableScrollLock:!0,PaperProps:{sx:{p:2,minWidth:200,maxWidth:400,pointerEvents:"auto",bgcolor:"#e3f2fd",borderRadius:2,boxShadow:3}},children:[_.title&&r.jsx(ae,{variant:"h6",sx:{fontWeight:600,color:"#1565c0",mb:1},children:_.title}),r.jsx(ae,{variant:"body2",sx:{fontWeight:500,color:"#1976d2",mb:1,whiteSpace:"pre-line"},children:_.text||""}),r.jsx(D,{display:"flex",justifyContent:"flex-end",children:r.jsx(ke,{onClick:()=>$({..._,open:!1}),sx:{background:"#1976d2",color:"#fff",borderRadius:2,padding:"4px 16px",fontWeight:600,fontSize:14,width:"auto",margin:0,"&:hover":{background:"#1565c0",color:"#fff"}},children:"OK"})})]})]})]})};export{rr as default};
