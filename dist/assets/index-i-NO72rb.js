import{u as Re,r as d,j as r,B as y,C as Me,T as P,R as ke}from"./index-Ic96-0uI.js";import{t as Te,C as Ae}from"./js.cookie-BDhdAvxg.js";import{H as ve,M as se,O as ce}from"./Header-Czk5TdvV.js";import{d as o,L as $e,A as Ee,D as L}from"./AdapterDayjs-4xP3l0wz.js";import{T as we,M as Ne,P as Pe,c as Le}from"./TextField-DUcxEuMZ.js";import{M as v}from"./Tooltip-07zIwyAt.js";import{I as Ye}from"./IconButton-6QtCe6bx.js";import{S as Be,T as Fe,a as Oe,b as We,c as $,d as ze}from"./SummarizeOutlined-CXAWghzY.js";import{T as s}from"./TableCell-DBnvbcrT.js";import"./api-DtAOtWGO.js";import"./InputAdornment-QPfNViMu.js";const nr=()=>{var z,I,H,q,G,U;const de=Re(),p=Te(de.palette.mode),[Y,B]=d.useState(null),[a,pe]=d.useState(o().startOf("month")),[l,me]=d.useState(o()),[R,ue]=d.useState(o()),[he,M]=d.useState(!1),[e,S]=d.useState({}),[F,k]=d.useState(null),[Ie,xe]=d.useState(!0),[He,fe]=d.useState(null),[f,O]=d.useState("Single Date Record"),[_,E]=d.useState({open:!1,anchorEl:null,text:"",title:""});d.useEffect(()=>{f==="Single Date Record"&&(async()=>{try{M(!0),k(null);const i=await ce.getCharges(R.format("YYYY-MM-DD"));S(i)}catch(i){console.error("Error fetching menu list:",i),k("Failed to fetch report. Please try again."),S({})}finally{M(!1)}})()},[R,f]),d.useEffect(()=>{if(f==="Multiple Date Record"&&a&&l&&o(a).isValid()&&o(l).isValid()){if(o(l).isBefore(o(a),"day")){console.error("End date cannot be before start date"),S({});return}(async()=>{try{M(!0),k(null);const i=await ce.getMultipleDateChargesReportList(o(a).format("YYYY-MM-DD"),o(l).format("YYYY-MM-DD"));S(i)}catch(i){console.error("Error fetching menu list:",i),k("Failed to fetch report. Please try again."),S({})}finally{M(!1)}})()}},[a,l,f]);const _e=t=>{t&&!t.isSame(R,"day")&&ue(t),xe(!1)},ge=t=>{B(t.currentTarget)},be=()=>{B(null)},W=()=>fe(null);return r.jsxs(y,{m:"20px",children:[r.jsx(ve,{title:"Charges Report",profileScreen:!0}),r.jsxs(y,{mt:"40px",height:"75vh",flex:1,sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{border:"none"},"& .name-column--cell":{color:p.greenAccent[300]},"& .MuiDataGrid-columnHeaders":{backgroundColor:p.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:p.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:p.blueAccent[700]},"& .MuiCheckbox-root":{color:`${p.greenAccent[200]} !important`},"& .MuiDataGrid-iconSeparator":{color:p.primary[100]}},children:[r.jsxs(y,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[r.jsx($e,{dateAdapter:Ee,children:f==="Multiple Date Record"?r.jsxs(y,{display:"flex",gap:2,children:[r.jsx(L,{label:"Start Date",value:a,onChange:t=>pe(t),maxDate:l,slotProps:{textField:{fullWidth:!0,variant:"filled",error:l&&a&&o(a).isAfter(o(l),"day"),helperText:l&&a&&o(a).isAfter(o(l),"day")?"Start date cannot be after end date":""}}}),r.jsx(L,{label:"End Date",value:l,onChange:t=>me(t),minDate:a,slotProps:{textField:{fullWidth:!0,variant:"filled",error:l&&a&&o(l).isBefore(o(a),"day"),helperText:l&&a&&o(l).isBefore(o(a),"day")?"End date cannot be before start date":""}}})]}):r.jsx(L,{label:"Date",value:R,onChange:_e,renderInput:t=>r.jsx(we,{...t,fullWidth:!0,variant:"filled",sx:{gridColumn:"span 1"}})})}),r.jsx(v,{title:"Reports",arrow:!0,children:r.jsx(Ye,{onClick:ge,sx:{color:p.blueAccent[700],"&:hover":{backgroundColor:p.blueAccent[800],color:p.gray[100]}},children:r.jsx(Be,{sx:{fontSize:"28px"}})})}),r.jsxs(Ne,{anchorEl:Y,open:!!Y,onClose:be,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},disableScrollLock:!0,children:[r.jsx(se,{selected:f==="Single Date Record",onClick:()=>{O("Single Date Record"),W()},children:"Single Date Record"}),r.jsx(se,{selected:f==="Multiple Date Record",onClick:()=>{O("Multiple Date Record"),W()},children:"Multiple Date Record"})]})]}),he?r.jsx(Me,{}):F?r.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh",sx:{borderRadius:2,padding:4},children:r.jsx(P,{variant:"h5",color:"error",sx:{fontWeight:600},children:F})}):r.jsx(Fe,{component:Pe,children:r.jsxs(Oe,{sx:{border:"1px solid rgba(224, 224, 224, 1)",borderCollapse:"collapse"},children:[r.jsxs(We,{children:[r.jsxs($,{sx:{backgroundColor:p.blueAccent[700]},children:[r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},rowSpan:2,children:"#"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((z=e==null?void 0:e.breakfast_item_list)==null?void 0:z.length)||0,1),children:"Breakfast"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((I=e==null?void 0:e.lunch_item_list)==null?void 0:I.length)||0,1),children:"Lunch"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((H=e==null?void 0:e.dinner_item_list)==null?void 0:H.length)||0,1),children:"Dinner"})]}),r.jsxs($,{sx:{backgroundColor:p.blueAccent[700]},children:[e!=null&&e.breakfast_item_list&&e.breakfast_item_list.length>0?e.breakfast_item_list.map((t,i)=>{const b=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(m=>`${m.date}: ${m.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(v,{title:b(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`breakfast-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"}),e!=null&&e.lunch_item_list&&e.lunch_item_list.length>0?e.lunch_item_list.map((t,i)=>{const b=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(m=>`${m.date}: ${m.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(v,{title:b(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`lunch-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"}),e!=null&&e.dinner_item_list&&e.dinner_item_list.length>0?e.dinner_item_list.map((t,i)=>{const b=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(m=>`${m.date}: ${m.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(v,{title:b(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`dinner-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"})]})]}),r.jsx(ze,{children:(!(e!=null&&e.report_breakfast_list)||e.report_breakfast_list.length===0)&&(!(e!=null&&e.report_lunch_list)||e.report_lunch_list.length===0)&&(!(e!=null&&e.report_dinner_list)||e.report_dinner_list.length===0)?r.jsx($,{children:r.jsx(s,{colSpan:Math.max(1+(((q=e==null?void 0:e.breakfast_item_list)==null?void 0:q.length)||0)+(((G=e==null?void 0:e.lunch_item_list)==null?void 0:G.length)||0)+(((U=e==null?void 0:e.dinner_item_list)==null?void 0:U.length)||0),4),align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)",padding:"40px",fontSize:"16px",fontWeight:500,color:p.gray[500]},children:"No Report Found"})}):(()=>{var m,K,J;const t=[...((m=e==null?void 0:e.report_breakfast_list)==null?void 0:m.map(c=>c.room_no))||[],...((K=e==null?void 0:e.report_lunch_list)==null?void 0:K.map(c=>c.room_no))||[],...((J=e==null?void 0:e.report_dinner_list)==null?void 0:J.map(c=>c.room_no))||[]];return[...new Set(t)].map(c=>({room_no:c})).map((c,qe)=>{var Q,V,X;const je=((Q=e==null?void 0:e.report_breakfast_list)==null?void 0:Q.find(x=>x.room_no===c.room_no))||{data:{},option:{}},ye=((V=e==null?void 0:e.report_lunch_list)==null?void 0:V.find(x=>x.room_no===c.room_no))||{data:{},option:{}},Se=((X=e==null?void 0:e.report_dinner_list)==null?void 0:X.find(x=>x.room_no===c.room_no))||{data:{},option:{}};return r.jsxs($,{children:[r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:c.room_no}),[{row:je,itemList:e==null?void 0:e.breakfast_item_list,prefix:"b"},{row:ye,itemList:e==null?void 0:e.lunch_item_list,prefix:"l"},{row:Se,itemList:e==null?void 0:e.dinner_item_list,prefix:"d"}].map(({row:x,itemList:w,prefix:Z},De)=>r.jsx(ke.Fragment,{children:w&&w.length>0?w.map((u,ee)=>{var ne,oe,ae,le,ie;const re=(u==null?void 0:u.item_name)||"";let D=(ne=x.data)==null?void 0:ne[re];const h=(oe=x.option)==null?void 0:oe[re];let g="";u.real_item_name?g=u.real_item_name:u.data&&(Array.isArray(u.data)?g=((ae=u.data[0])==null?void 0:ae.real_item_name)||"":u.data.real_item_name&&(g=u.data.real_item_name));let C="",T="",te="";if(Array.isArray(h))if(h.length>0&&((le=h[0])==null?void 0:le.date)&&((ie=h[0])==null?void 0:ie.items)){te=g;const j=[];h.forEach(n=>{n.date&&Array.isArray(n.items)&&n.items.forEach(A=>{A.itemName&&j.push(`${n.date}: ${A.itemName}`)})}),C=j.join(", "),T=j.join(`
`)}else{const j=h.filter(n=>n&&(typeof n=="object"?n.itemName||n.optionName:n)).map(n=>{if(typeof n=="object"&&(n.itemName||n.optionName)){const A=n.itemName||n.optionName;return`${g} - ${A}`}return typeof n=="string"?`${g} - ${n}`:""}).filter(n=>n.trim().length>0);C=j.join(", "),T=j.join(`
`)}else typeof h=="string"&&(C=h,T=`${g} - ${h}`);const Ce=ee>=4&&D>=1&&C&&C.trim().length>0;return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:D==null?"-":Ce?r.jsx("span",{style:{textDecoration:"underline",cursor:"pointer",color:"#1976d2"},onClick:N=>{N.stopPropagation(),E({open:!0,anchorEl:N.currentTarget,text:T||"No option available",title:te})},children:D}):D},`${Z}-${ee}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"})},`${Z}-meal-${De}`))]},c.room_no)})})()})]})}),r.jsxs(Le,{open:_.open,anchorEl:_.anchorEl,onClose:()=>E({..._,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},disableEnforceFocus:!0,disableRestoreFocus:!0,disableScrollLock:!0,PaperProps:{sx:{p:2,minWidth:200,maxWidth:400,pointerEvents:"auto",bgcolor:"#e3f2fd",borderRadius:2,boxShadow:3}},children:[_.title&&r.jsx(P,{variant:"h6",sx:{fontWeight:600,color:"#1565c0",mb:1},children:_.title}),r.jsx(P,{variant:"body2",sx:{fontWeight:500,color:"#1976d2",mb:1,whiteSpace:"pre-line"},children:_.text||""}),r.jsx(y,{display:"flex",justifyContent:"flex-end",children:r.jsx(Ae,{onClick:()=>E({..._,open:!1}),sx:{background:"#1976d2",color:"#fff",borderRadius:2,padding:"4px 16px",fontWeight:600,fontSize:14,width:"auto",margin:0,"&:hover":{background:"#1565c0",color:"#fff"}},children:"OK"})})]})]})]})};export{nr as default};
