import{u as Se,r as p,j as r,B as C,C as Ce,T as Y,R as Re}from"./index-BZY8vtw2.js";import{t as Me,C as ke}from"./js.cookie-DmcBEx43.js";import{H as Te,M as ce,O as de}from"./Header-6Eh_lsGm.js";import{d as a,L as ve,A as Ae,D as B}from"./AdapterDayjs-DZI8FuiA.js";import{T as Ee,M as $e,P as Pe,c as we}from"./TextField-B_AckVpU.js";import{M as E}from"./Tooltip-CQHIUUXW.js";import{I as Ne}from"./IconButton-Cxapgqpi.js";import{S as Le,T as Ye,a as Be,b as Fe,c as $,d as Oe}from"./SummarizeOutlined-DYkys3pg.js";import{T as s}from"./TableCell-Llxf6iCc.js";import"./api-CdWu8_6M.js";import"./InputAdornment-Bt0ACj6N.js";const er=()=>{var z,H,q,G,U,K;const pe=Se(),c=Me(pe.palette.mode),[F,O]=p.useState(null),[l,me]=p.useState(a().startOf("month")),[i,ue]=p.useState(a()),[k,he]=p.useState(a()),[y,T]=p.useState(!1),[e,g]=p.useState({}),[I,m]=p.useState(null),[Ie,fe]=p.useState(!0);p.useState(null);const[_,W]=p.useState("Single Date Record"),[b,P]=p.useState({open:!1,anchorEl:null,text:"",title:""});p.useEffect(()=>{_==="Single Date Record"&&(async()=>{try{T(!0),m(null);const o=await de.getCharges(k.format("YYYY-MM-DD"));o&&typeof o=="object"?(g(o),m(null)):(m("Invalid response format. Please try again."),g({}))}catch(o){console.error("Error fetching charges report:",o),m("Failed to fetch report. Please try again."),g({})}finally{T(!1)}})()},[k,_]),p.useEffect(()=>{if(_==="Multiple Date Record"&&l&&i&&a(l).isValid()&&a(i).isValid()){if(a(i).isBefore(a(l),"day")){console.error("End date cannot be before start date"),m("End date cannot be before start date"),g({});return}(async()=>{try{T(!0),m(null);const o=await de.getMultipleDateChargesReportList(a(l).format("YYYY-MM-DD"),a(i).format("YYYY-MM-DD"));o&&typeof o=="object"?(g(o),m(null)):(m("Invalid response format. Please try again."),g({}))}catch(o){console.error("Error fetching charges report:",o),m("Failed to fetch report. Please try again."),g({})}finally{T(!1)}})()}},[l,i,_]);const xe=t=>{t&&!t.isSame(k,"day")&&he(t),fe(!1)},ge=t=>{O(t.currentTarget)},w=()=>{O(null)};return r.jsxs(C,{m:"20px",children:[r.jsx(Te,{title:"Charges Report",profileScreen:!0}),r.jsxs(C,{mt:"40px",height:"75vh",flex:1,sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{border:"none"},"& .name-column--cell":{color:c.greenAccent[300]},"& .MuiDataGrid-columnHeaders":{backgroundColor:c.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:c.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:c.blueAccent[700]},"& .MuiCheckbox-root":{color:`${c.greenAccent[200]} !important`},"& .MuiDataGrid-iconSeparator":{color:c.primary[100]}},children:[r.jsxs(C,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[r.jsx(ve,{dateAdapter:Ae,children:_==="Multiple Date Record"?r.jsxs(C,{display:"flex",gap:2,children:[r.jsx(B,{label:"Start Date",value:l,onChange:t=>me(t),maxDate:i,disabled:y,slotProps:{textField:{fullWidth:!0,variant:"filled",error:i&&l&&a(l).isAfter(a(i),"day"),helperText:i&&l&&a(l).isAfter(a(i),"day")?"Start date cannot be after end date":""}}}),r.jsx(B,{label:"End Date",value:i,onChange:t=>ue(t),minDate:l,disabled:y,slotProps:{textField:{fullWidth:!0,variant:"filled",error:i&&l&&a(i).isBefore(a(l),"day"),helperText:i&&l&&a(i).isBefore(a(l),"day")?"End date cannot be before start date":""}}})]}):r.jsx(B,{label:"Date",value:k,onChange:xe,disabled:y,renderInput:t=>r.jsx(Ee,{...t,fullWidth:!0,variant:"filled",sx:{gridColumn:"span 1"}})})}),r.jsx(E,{title:y?"Loading...":"Reports",arrow:!0,children:r.jsx("span",{children:r.jsx(Ne,{onClick:ge,disabled:y,sx:{color:c.blueAccent[700],"&:hover":{backgroundColor:c.blueAccent[800],color:c.gray[100]},"&.Mui-disabled":{color:c.gray[500],opacity:.5}},children:r.jsx(Le,{sx:{fontSize:"28px"}})})})}),r.jsxs($e,{anchorEl:F,open:!!F,onClose:w,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},disableScrollLock:!0,children:[r.jsx(ce,{selected:_==="Single Date Record",onClick:()=>{W("Single Date Record"),m(null),w()},children:"Single Date Record"}),r.jsx(ce,{selected:_==="Multiple Date Record",onClick:()=>{W("Multiple Date Record"),m(null),w()},children:"Multiple Date Record"})]})]}),y?r.jsx(Ce,{}):I?r.jsx(C,{display:"flex",justifyContent:"center",alignItems:"center",height:"60vh",sx:{borderRadius:2,padding:4},children:r.jsx(Y,{variant:"h5",color:"error",sx:{fontWeight:600},children:I})}):r.jsx(Ye,{component:Pe,children:r.jsxs(Be,{sx:{border:"1px solid rgba(224, 224, 224, 1)",borderCollapse:"collapse"},children:[r.jsxs(Fe,{children:[r.jsxs($,{sx:{backgroundColor:c.blueAccent[700]},children:[r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},rowSpan:2,children:"#"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((z=e==null?void 0:e.breakfast_item_list)==null?void 0:z.length)||0,1),children:"Breakfast"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((H=e==null?void 0:e.lunch_item_list)==null?void 0:H.length)||0,1),children:"Lunch"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((q=e==null?void 0:e.dinner_item_list)==null?void 0:q.length)||0,1),children:"Dinner"})]}),r.jsxs($,{sx:{backgroundColor:c.blueAccent[700]},children:[e!=null&&e.breakfast_item_list&&e.breakfast_item_list.length>0?e.breakfast_item_list.map((t,o)=>{const D=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(u=>`${u.date}: ${u.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(E,{title:D(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`breakfast-${o}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"}),e!=null&&e.lunch_item_list&&e.lunch_item_list.length>0?e.lunch_item_list.map((t,o)=>{const D=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(u=>`${u.date}: ${u.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(E,{title:D(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`lunch-${o}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"}),e!=null&&e.dinner_item_list&&e.dinner_item_list.length>0?e.dinner_item_list.map((t,o)=>{const D=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(u=>`${u.date}: ${u.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(E,{title:D(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`dinner-${o}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"})]})]}),r.jsx(Oe,{children:(!(e!=null&&e.report_breakfast_list)||e.report_breakfast_list.length===0)&&(!(e!=null&&e.report_lunch_list)||e.report_lunch_list.length===0)&&(!(e!=null&&e.report_dinner_list)||e.report_dinner_list.length===0)?r.jsx($,{children:r.jsx(s,{colSpan:Math.max(1+(((G=e==null?void 0:e.breakfast_item_list)==null?void 0:G.length)||0)+(((U=e==null?void 0:e.lunch_item_list)==null?void 0:U.length)||0)+(((K=e==null?void 0:e.dinner_item_list)==null?void 0:K.length)||0),4),align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)",padding:"40px",fontSize:"16px",fontWeight:500,color:c.gray[500]},children:"No Report Found"})}):(()=>{var u,J,Q;const t=[...((u=e==null?void 0:e.report_breakfast_list)==null?void 0:u.map(d=>d.room_no))||[],...((J=e==null?void 0:e.report_lunch_list)==null?void 0:J.map(d=>d.room_no))||[],...((Q=e==null?void 0:e.report_dinner_list)==null?void 0:Q.map(d=>d.room_no))||[]];return[...new Set(t)].map(d=>({room_no:d})).map((d,We)=>{var V,X,Z;const _e=((V=e==null?void 0:e.report_breakfast_list)==null?void 0:V.find(x=>x.room_no===d.room_no))||{data:{},option:{}},be=((X=e==null?void 0:e.report_lunch_list)==null?void 0:X.find(x=>x.room_no===d.room_no))||{data:{},option:{}},je=((Z=e==null?void 0:e.report_dinner_list)==null?void 0:Z.find(x=>x.room_no===d.room_no))||{data:{},option:{}};return r.jsxs($,{children:[r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:d.room_no}),[{row:_e,itemList:e==null?void 0:e.breakfast_item_list,prefix:"b"},{row:be,itemList:e==null?void 0:e.lunch_item_list,prefix:"l"},{row:je,itemList:e==null?void 0:e.dinner_item_list,prefix:"d"}].map(({row:x,itemList:N,prefix:ee},ye)=>r.jsx(Re.Fragment,{children:N&&N.length>0?N.map((h,re)=>{var oe,ae,le,ie,se;const te=(h==null?void 0:h.item_name)||"";let R=(oe=x.data)==null?void 0:oe[te];const f=(ae=x.option)==null?void 0:ae[te];let j="";h.real_item_name?j=h.real_item_name:h.data&&(Array.isArray(h.data)?j=((le=h.data[0])==null?void 0:le.real_item_name)||"":h.data.real_item_name&&(j=h.data.real_item_name));let M="",v="",ne="";if(Array.isArray(f))if(f.length>0&&((ie=f[0])==null?void 0:ie.date)&&((se=f[0])==null?void 0:se.items)){ne=j;const S=[];f.forEach(n=>{n.date&&Array.isArray(n.items)&&n.items.forEach(A=>{A.itemName&&S.push(`${n.date}: ${A.itemName}`)})}),M=S.join(", "),v=S.join(`
`)}else{const S=f.filter(n=>n&&(typeof n=="object"?n.itemName||n.optionName:n)).map(n=>{if(typeof n=="object"&&(n.itemName||n.optionName)){const A=n.itemName||n.optionName;return`${j} - ${A}`}return typeof n=="string"?`${j} - ${n}`:""}).filter(n=>n.trim().length>0);M=S.join(", "),v=S.join(`
`)}else typeof f=="string"&&(M=f,v=`${j} - ${f}`);const De=re>=4&&R>=1&&M&&M.trim().length>0;return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:R==null?"-":De?r.jsx("span",{style:{textDecoration:"underline",cursor:"pointer",color:"#1976d2"},onClick:L=>{L.stopPropagation(),P({open:!0,anchorEl:L.currentTarget,text:v||"No option available",title:ne})},children:R}):R},`${ee}-${re}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"})},`${ee}-meal-${ye}`))]},d.room_no)})})()})]})}),r.jsxs(we,{open:b.open,anchorEl:b.anchorEl,onClose:()=>P({...b,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},disableEnforceFocus:!0,disableRestoreFocus:!0,disableScrollLock:!0,PaperProps:{sx:{p:2,minWidth:200,maxWidth:400,pointerEvents:"auto",bgcolor:"#e3f2fd",borderRadius:2,boxShadow:3}},children:[b.title&&r.jsx(Y,{variant:"h6",sx:{fontWeight:600,color:"#1565c0",mb:1},children:b.title}),r.jsx(Y,{variant:"body2",sx:{fontWeight:500,color:"#1976d2",mb:1,whiteSpace:"pre-line"},children:b.text||""}),r.jsx(C,{display:"flex",justifyContent:"flex-end",children:r.jsx(ke,{onClick:()=>P({...b,open:!1}),sx:{background:"#1976d2",color:"#fff",borderRadius:2,padding:"4px 16px",fontWeight:600,fontSize:14,width:"auto",margin:0,"&:hover":{background:"#1565c0",color:"#fff"}},children:"OK"})})]})]})]})};export{er as default};
