import{u as ye,r as m,j as r,B as D,C as Se,R as De,T as Ce}from"./index-CodQRM2_.js";import{t as Re,C as Me}from"./js.cookie-BybCkJHP.js";import{H as ke,M as oe,O as ae}from"./Header-2taakBUg.js";import{d as o,L as Ae,A as Te,D as N}from"./AdapterDayjs-CdgdMBET.js";import{T as $e,M as ve,P as Ee,c as we}from"./TextField-BaKOL4Mz.js";import{M as A}from"./Tooltip-oVoQRNVY.js";import{I as Ne}from"./IconButton-DDLZAioE.js";import{S as Le,T as Pe,a as Ye,b as Be,c as T,d as Oe}from"./SummarizeOutlined-o3t5MWep.js";import{T as s}from"./TableCell-fPxvzuiX.js";import"./api-CsyZAihm.js";import"./InputAdornment-40mVDWCU.js";const er=()=>{var O,z,F,W,I,H;const le=ye(),d=Re(le.palette.mode),[L,P]=m.useState(null),[a,ie]=m.useState(o().startOf("month")),[l,se]=m.useState(o()),[C,ce]=m.useState(o()),[de,R]=m.useState(!1),[e,$]=m.useState({}),[ze,me]=m.useState(!0),[Fe,pe]=m.useState(null),[f,Y]=m.useState("Single Date Record"),[j,v]=m.useState({open:!1,anchorEl:null,text:""});m.useEffect(()=>{f==="Single Date Record"&&(async()=>{try{R(!0);const i=await ae.getCharges(C.format("YYYY-MM-DD"));$(i)}catch(i){console.error("Error fetching menu list:",i)}finally{R(!1)}})()},[C,f]),m.useEffect(()=>{if(f==="Multiple Date Record"&&a&&l&&o(a).isValid()&&o(l).isValid()){if(o(l).isBefore(o(a),"day")){console.error("End date cannot be before start date"),$({});return}(async()=>{try{R(!0);const i=await ae.getMultipleDateChargesReportList(o(a).format("YYYY-MM-DD"),o(l).format("YYYY-MM-DD"));$(i)}catch(i){console.error("Error fetching menu list:",i)}finally{R(!1)}})()}},[a,l,f]);const ue=t=>{t&&!t.isSame(C,"day")&&ce(t),me(!1)},he=t=>{P(t.currentTarget)},xe=()=>{P(null)},B=()=>pe(null);return r.jsxs(D,{m:"20px",children:[r.jsx(ke,{title:"Charges Report",profileScreen:!0}),r.jsxs(D,{mt:"40px",height:"75vh",flex:1,sx:{"& .MuiDataGrid-root":{border:"none"},"& .MuiDataGrid-cell":{border:"none"},"& .name-column--cell":{color:d.greenAccent[300]},"& .MuiDataGrid-columnHeaders":{backgroundColor:d.blueAccent[700],borderBottom:"none"},"& .MuiDataGrid-virtualScroller":{backgroundColor:d.primary[400]},"& .MuiDataGrid-footerContainer":{borderTop:"none",backgroundColor:d.blueAccent[700]},"& .MuiCheckbox-root":{color:`${d.greenAccent[200]} !important`},"& .MuiDataGrid-iconSeparator":{color:d.primary[100]}},children:[r.jsxs(D,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,children:[r.jsx(Ae,{dateAdapter:Te,children:f==="Multiple Date Record"?r.jsxs(D,{display:"flex",gap:2,children:[r.jsx(N,{label:"Start Date",value:a,onChange:t=>ie(t),maxDate:l,slotProps:{textField:{fullWidth:!0,variant:"filled",error:l&&a&&o(a).isAfter(o(l),"day"),helperText:l&&a&&o(a).isAfter(o(l),"day")?"Start date cannot be after end date":""}}}),r.jsx(N,{label:"End Date",value:l,onChange:t=>se(t),minDate:a,slotProps:{textField:{fullWidth:!0,variant:"filled",error:l&&a&&o(l).isBefore(o(a),"day"),helperText:l&&a&&o(l).isBefore(o(a),"day")?"End date cannot be before start date":""}}})]}):r.jsx(N,{label:"Date",value:C,onChange:ue,renderInput:t=>r.jsx($e,{...t,fullWidth:!0,variant:"filled",sx:{gridColumn:"span 1"}})})}),r.jsx(A,{title:"Reports",arrow:!0,children:r.jsx(Ne,{onClick:he,sx:{color:d.blueAccent[700],"&:hover":{backgroundColor:d.blueAccent[800],color:d.gray[100]}},children:r.jsx(Le,{sx:{fontSize:"28px"}})})}),r.jsxs(ve,{anchorEl:L,open:!!L,onClose:xe,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},disableScrollLock:!0,children:[r.jsx(oe,{selected:f==="Single Date Record",onClick:()=>{Y("Single Date Record"),B()},children:"Single Date Record"}),r.jsx(oe,{selected:f==="Multiple Date Record",onClick:()=>{Y("Multiple Date Record"),B()},children:"Multiple Date Record"})]})]}),de?r.jsx(Se,{}):r.jsx(Pe,{component:Ee,children:r.jsxs(Ye,{sx:{border:"1px solid rgba(224, 224, 224, 1)",borderCollapse:"collapse"},children:[r.jsxs(Be,{children:[r.jsxs(T,{sx:{backgroundColor:d.blueAccent[700]},children:[r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},rowSpan:2,children:"#"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((O=e==null?void 0:e.breakfast_item_list)==null?void 0:O.length)||0,1),children:"Breakfast"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((z=e==null?void 0:e.lunch_item_list)==null?void 0:z.length)||0,1),children:"Lunch"}),r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},colSpan:Math.max(((F=e==null?void 0:e.dinner_item_list)==null?void 0:F.length)||0,1),children:"Dinner"})]}),r.jsxs(T,{sx:{backgroundColor:d.blueAccent[700]},children:[e!=null&&e.breakfast_item_list&&e.breakfast_item_list.length>0?e.breakfast_item_list.map((t,i)=>{const g=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(p=>`${p.date}: ${p.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(A,{title:g(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`breakfast-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"}),e!=null&&e.lunch_item_list&&e.lunch_item_list.length>0?e.lunch_item_list.map((t,i)=>{const g=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(p=>`${p.date}: ${p.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(A,{title:g(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`lunch-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"}),e!=null&&e.dinner_item_list&&e.dinner_item_list.length>0?e.dinner_item_list.map((t,i)=>{const g=()=>{if(t.real_item_name)return t.real_item_name;if(t.data){if(Array.isArray(t.data))return t.data.map(p=>`${p.date}: ${p.real_item_name}`).join(`
`);if(t.data.real_item_name)return t.data.real_item_name}return t.item_name};return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:r.jsx(A,{title:g(),arrow:!0,children:r.jsx("span",{children:t.item_name})})},`dinner-${i}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"})]})]}),r.jsx(Oe,{children:(!(e!=null&&e.report_breakfast_list)||e.report_breakfast_list.length===0)&&(!(e!=null&&e.report_lunch_list)||e.report_lunch_list.length===0)&&(!(e!=null&&e.report_dinner_list)||e.report_dinner_list.length===0)?r.jsx(T,{children:r.jsx(s,{colSpan:Math.max(1+(((W=e==null?void 0:e.breakfast_item_list)==null?void 0:W.length)||0)+(((I=e==null?void 0:e.lunch_item_list)==null?void 0:I.length)||0)+(((H=e==null?void 0:e.dinner_item_list)==null?void 0:H.length)||0),4),align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)",padding:"40px",fontSize:"16px",fontWeight:500,color:d.gray[500]},children:"No Report Found"})}):(()=>{var p,q,G;const t=[...((p=e==null?void 0:e.report_breakfast_list)==null?void 0:p.map(c=>c.room_no))||[],...((q=e==null?void 0:e.report_lunch_list)==null?void 0:q.map(c=>c.room_no))||[],...((G=e==null?void 0:e.report_dinner_list)==null?void 0:G.map(c=>c.room_no))||[]];return[...new Set(t)].map(c=>({room_no:c})).map((c,We)=>{var U,K,J;const fe=((U=e==null?void 0:e.report_breakfast_list)==null?void 0:U.find(x=>x.room_no===c.room_no))||{data:{},option:{}},_e=((K=e==null?void 0:e.report_lunch_list)==null?void 0:K.find(x=>x.room_no===c.room_no))||{data:{},option:{}},ge=((J=e==null?void 0:e.report_dinner_list)==null?void 0:J.find(x=>x.room_no===c.room_no))||{data:{},option:{}};return r.jsxs(T,{children:[r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:c.room_no}),[{row:fe,itemList:e==null?void 0:e.breakfast_item_list,prefix:"b"},{row:_e,itemList:e==null?void 0:e.lunch_item_list,prefix:"l"},{row:ge,itemList:e==null?void 0:e.dinner_item_list,prefix:"d"}].map(({row:x,itemList:E,prefix:Q},be)=>r.jsx(De.Fragment,{children:E&&E.length>0?E.map((u,V)=>{var Z,ee,re,te,ne;const X=(u==null?void 0:u.item_name)||"";let y=(Z=x.data)==null?void 0:Z[X];const h=(ee=x.option)==null?void 0:ee[X];let _="";u.real_item_name?_=u.real_item_name:u.data&&(Array.isArray(u.data)?_=((re=u.data[0])==null?void 0:re.real_item_name)||"":u.data.real_item_name&&(_=u.data.real_item_name));let S="",M="";if(Array.isArray(h))if(h.length>0&&((te=h[0])==null?void 0:te.date)&&((ne=h[0])==null?void 0:ne.items)){const b=[];h.forEach(n=>{n.date&&Array.isArray(n.items)&&n.items.forEach(k=>{k.itemName&&b.push(`${n.date}: ${_} - ${k.itemName}`)})}),S=b.join(", "),M=b.join(`
`)}else{const b=h.filter(n=>n&&(typeof n=="object"?n.itemName||n.optionName:n)).map(n=>{if(typeof n=="object"&&(n.itemName||n.optionName)){const k=n.itemName||n.optionName;return`${_} - ${k}`}return typeof n=="string"?`${_} - ${n}`:""}).filter(n=>n.trim().length>0);S=b.join(", "),M=b.join(`
`)}else typeof h=="string"&&(S=h,M=`${_} - ${h}`);const je=V>=4&&y>=1&&S&&S.trim().length>0;return r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:y==null?"-":je?r.jsx("span",{style:{textDecoration:"underline",cursor:"pointer",color:"#1976d2"},onClick:w=>{w.stopPropagation(),v({open:!0,anchorEl:w.currentTarget,text:M||"No option available"})},children:y}):y},`${Q}-${V}`)}):r.jsx(s,{align:"center",sx:{border:"1px solid rgba(224, 224, 224, 1)"},children:"-"})},`${Q}-meal-${be}`))]},c.room_no)})})()})]})}),r.jsxs(we,{open:j.open,anchorEl:j.anchorEl,onClose:()=>v({...j,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},disableEnforceFocus:!0,disableRestoreFocus:!0,disableScrollLock:!0,PaperProps:{sx:{p:2,minWidth:200,maxWidth:400,pointerEvents:"auto",bgcolor:"#e3f2fd",borderRadius:2,boxShadow:3}},children:[r.jsx(Ce,{variant:"body2",sx:{fontWeight:500,color:"#1976d2",mb:1,whiteSpace:"pre-line"},children:j.text||""}),r.jsx(D,{display:"flex",justifyContent:"flex-end",children:r.jsx(Me,{onClick:()=>v({...j,open:!1}),sx:{background:"#1976d2",color:"#fff",borderRadius:2,padding:"4px 16px",fontWeight:600,fontSize:14,width:"auto",margin:0,"&:hover":{background:"#1565c0",color:"#fff"}},children:"OK"})})]})]})]})};export{er as default};
